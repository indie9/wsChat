import{U as x}from"./UserCard-Tb7BguTl.js";import{_ as k,m as g,b,d as l,r as y,c as a,a as e,h as L,i as h,t as d,F as S,e as M,g as V,u as B,f as R,o as r,n as A,w as f,p as I,j as N,k as j}from"./index-My5lkwnf.js";import{s as C}from"./socketStore-DCQENQbp.js";const D={components:{UserCard:x},data(){return{chatsList:[],currentChat:null,usersCount:null}},mounted(){this.fetchChats(),this.connection(),this.socket.on("online",t=>{var s;this.usersCount=(s=JSON.parse(t))==null?void 0:s.count})},beforeDestroy(){this.socket.disconnect()},beforeRouteLeave(){this.socket.disconnect()},computed:{...g(B,["user"]),...g(C,["socket"]),isAdmin(){var t,s;return(s=(t=this.user)==null?void 0:t.roles)==null?void 0:s.includes("ADMIN")}},inject:["host"],methods:{...b(R,["openModal"]),...b(C,["connection"]),avatarSRC(t){return this.host+"/"+t},addChat(t=null){this.openModal("EditChatModal",{title:t?"Edit chat":"Create chat",chat:t},s=>t?l.chatService.edit(s).then(()=>{this.fetchChats()}):l.chatService.create(s).then(()=>{this.fetchChats()}))},deleteChat(t){this.openModal("ConfirmModal",{title:"Chat delete",text:`You want to delete a chat ${t.title}?`},()=>l.chatService.deleteChat(t._id).then(()=>{this.currentChat==t._id&&(this.currentChat=null,this.$router.push("/chats")),this.fetchChats()}))},fetchChats(){return l.chatService.getChats().then(t=>{t&&t.data&&(this.chatsList=t.data)})},enterRoom(t){this.currentChat=t,this.$router.push(`/chats/${t}`,{params:{id:t}})}}},c=t=>(I("data-v-da5c7c48"),t=t(),N(),t),E={class:"flex main-wrapper h-full"},H={class:"w-1/4 bg-gray-200 p-4 max-h-full"},U={class:"flex items-center min-h-10"},F=c(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",class:"mr-2 hover:bg-blue-500",fill:"currentColor"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)),P={class:"flex items-center ml-auto"},Z={class:"mr-2 text-gray-600"},$=c(()=>e("div",{class:"h-3 w-3 bg-green-500 rounded-full animate-ping"},null,-1)),z={class:"chatl-list-wrapper overflow-y-auto"},O=["onClick"],J={class:"m-1"},T={class:"text-lg font-bold mb-2 text-black"},X={class:"text-sm text-gray-600 mb-1 flex items-center"},Y=c(()=>e("div",{class:"text-l"}," By ",-1)),q={class:"text-l font-bold text-black ml-2 mr-2"},G=["src"],K={key:1,src:j,class:"w-6 h-6 rounded-full object-cover",alt:"User Photo"},Q={key:0,class:"absolute hidden items-center right-2 top-2 group-hover:flex"},W=["onClick"],tt=c(()=>e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M15.728 9.68601L14.314 8.27201L5 17.586V19H6.414L15.728 9.68601ZM17.142 8.27201L18.556 6.85801L17.142 5.44401L15.728 6.85801L17.142 8.27201ZM7.242 21H3V16.757L16.435 3.32201C16.6225 3.13454 16.8768 3.02922 17.142 3.02922C17.4072 3.02922 17.6615 3.13454 17.849 3.32201L20.678 6.15101C20.8655 6.33853 20.9708 6.59284 20.9708 6.85801C20.9708 7.12317 20.8655 7.37748 20.678 7.56501L7.243 21H7.242Z",fill:"currentColor"})],-1)),et=[tt],st=["onClick"],ot={class:"w-3/4 bg-white p-4 max-h-full bg-gradient-to-b from-gray-100 to-gray-300"},rt={key:0,class:"text-4xl font-bold text-center text-gray-300 mt-32"};function at(t,s,nt,it,i,n){const w=y("RouterView");return r(),a("div",E,[e("div",H,[e("div",U,[n.isAdmin?(r(),a("button",{key:0,onClick:s[0]||(s[0]=o=>n.addChat(null)),class:"flex bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded mb-2"},[F,L(" Add chat ")])):h("",!0),e("div",P,[e("p",Z,"Online: "+d(i.usersCount),1),$])]),e("div",z,[(r(!0),a(S,null,M(i.chatsList,o=>{var u,_,m,p;return r(),a("div",{key:o._id,onClick:v=>n.enterRoom(o._id),class:A([{"bg-[#DCFCE7] hover:bg-green-200":o._id==i.currentChat},"cursor-pointer rounded-lg shadow-lg p-2 bg-white bg-green-100 hover:bg-gray-100 mb-2 mr-2 relative group"])},[e("div",J,[e("div",null,[e("h3",T,d(o.title),1),e("p",X,[Y,e("span",q,d(((u=o.author)==null?void 0:u.username)||"Удалён"),1),(_=o.author)!=null&&_.avatar?(r(),a("img",{key:0,src:n.avatarSRC((m=o.author)==null?void 0:m.avatar),class:"w-6 h-6 rounded-full object-cover",alt:"User Photo"},null,8,G)):(r(),a("img",K))])])]),((p=o.author)==null?void 0:p._id)==t.user._id?(r(),a("div",Q,[(r(),a("button",{key:0,onClick:f(v=>n.addChat(o),["stop"]),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-full h-6 w-6 p-1 ml-auto"},et,8,W)),t.isMaster?h("",!0):(r(),a("button",{key:1,onClick:f(v=>n.deleteChat(o),["stop"]),class:"bg-red-500 hover:bg-red-600 text-white font-bold rounded-full h-6 w-6 ml-2"}," X ",8,st))])):h("",!0)],10,O)}),128))])]),e("div",ot,[(r(),V(w,{key:t.$route.fullPath})),i.currentChat?h("",!0):(r(),a("h1",rt,"Выберите комнату"))])])}const dt=k(D,[["render",at],["__scopeId","data-v-da5c7c48"]]);export{dt as default};
